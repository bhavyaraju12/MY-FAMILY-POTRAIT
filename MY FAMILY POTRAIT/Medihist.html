<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600&amp;subset=cyrillic,latin">
    <style>
        .bg-custom-green {
            background-color: #ebf0e6; /* Darker shade of green */
        }
    </style>
</head>
<body class="bg-gray-100">

<div class="container mx-auto px-4 py-8">
    <!-- User Profile Card -->
    <div class="bg-custom-green p-6 mb-6 rounded-lg shadow-md" id="patient-information">
        <!-- Patient information will be dynamically populated here -->
    </div>

    <!-- Relatives Card -->
    <div class="bg-custom-green p-6 mb-6 rounded-lg shadow-md" id="relatives-information">
        <h2 class="text-xl font-bold text-green-500 mb-4">Relatives' Information</h2>
        <!-- Relatives' information will be dynamically populated here -->
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
    // Initialize Supabase
    const { createClient } = supabase;
    const supabaseUrl = 'https://nbkplmfperjtegugcwzz.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ia3BsbWZwZXJqdGVndWdjd3p6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTgxNzQzMDUsImV4cCI6MjAzMzc1MDMwNX0.u52UJNzNT3jEhLQCVfzyeqxSCVwlYgdT538pqDB9Ap0';
    const database = createClient(supabaseUrl, supabaseKey);

   
async function fetchPatientAndRelatives(userId) {
    try {
        // Fetch patient data by user ID
        const { data: patientData, error: patientError } = await database
            .from('Patient Form')
            .select('*')
            .eq('user_id', userId)
            .single();
        console.log(patientData);
        if (patientError) {
            console.error('Error fetching patient data:', patientError);
            return;
        }

        // Populate patient information
        const patientContainer = document.getElementById('patient-information');
patientContainer.innerHTML = `
    <h2 class="text-xl font-bold color-green mb-4">User Profile</h2>
    <div class="flex items-center mb-4">
        <img src="${patientData.photo_url}" alt="User Photo" class="w-16 h-16 rounded-full mr-4">
        <div>
            <p class="text-lg font-semibold">${patientData.name}</p>
            <p class="text-sm text-black-300">Email: ${patientData.email}</p>
        </div>
    </div>
            <table class="table-auto w-full mb-4 text-green">
                <tbody>
                    <tr>
                        <td class="font-semibold">Date of Birth:</td>
                        <td>${patientData.dob}</td>
                    </tr>
                    <tr>
                        <td class="font-semibold">Gender:</td>
                        <td>${patientData.gender}</td>
                    </tr>
                    <tr>
                        <td class="font-semibold">Height (cm):</td>
                        <td>${patientData.height}</td>
                    </tr>
                    <tr>
                        <td class="font-semibold">Weight (kg):</td>
                        <td>${patientData.weight}</td>
                    </tr>
                    <tr>
                        <td class="font-semibold">Blood Type:</td>
                        <td>${patientData.blood_type}</td>
                    </tr>
                    <tr>
                        <td class="font-semibold">Allergies:</td>
                        <td>${JSON.parse(patientData.allergies)}</td>
                    </tr>
                    <tr>
                        <td class="font-semibold">Current Medications:</td>
                        <td>${patientData.medications}</td>
                    </tr>
                    <tr>
                        <td class="font-semibold">Medical Conditions:</td>
                        <td>${JSON.parse(patientData.medical_conditions)}</td>
                    </tr>
                    <tr>
                        <td class="font-semibold">Born a Twin:</td>
                        <td>${patientData.twin}</td>
                    </tr>
                    <tr>
                        <td class="font-semibold">Adopted:</td>
                        <td>${patientData.adopted}</td>
                    </tr>
                </tbody>
            </table>
            <button style="background-color: #72c02c;color: white; border-radius: 5px; border: 4px; padding: 10px;">
                <a href="form.html">Update</a>
            </button>
        `;

        // Fetch relatives data for the specific patient
        const { data: relativesData, error: relativesError } = await database
            .from('relatives')
            .select('*')
            .eq('patient_id', patientData.id);

        if (relativesError) {
            console.error('Error fetching relatives:', relativesError);
            return;
        }

        // Populate relatives information
        const relativesContainer = document.getElementById('relatives-information');
        relativesContainer.innerHTML = ''; // Clear any existing content

        relativesData.forEach(relative => {
    const relativeCard = `
        <div class="flex items-center mb-4">
            <img src="${relative.photo_url}" alt="Relative Photo" class="w-16 h-16 rounded-full mr-4">
            <div>
                <p class="text-lg font-semibold">${relative.name}</p>
                <p class="text-sm text-black-300">Relationship: ${relative.relationship}</p>
            </div>
        </div>
                <table class="table-auto w-full mb-4 text-green">
                    <tbody>
                        <tr>
                            <td class="font-semibold">Height (cm):</td>
                            <td>${relative.height}</td>
                        </tr>
                        <tr>
                            <td class="font-semibold">Weight (kg):</td>
                            <td>${relative.weight}</td>
                        </tr>
                        <tr>
                            <td class="font-semibold">Medical conditions:</td>
                            <td>${JSON.parse(patientData.medical_conditions)}</td>
                        </tr>
                        <tr>
                            <td class="font-semibold">Age:</td>
                            <td>${relative.age}</td>
                        </tr>
                    </tbody>
                </table>
            `;
            relativesContainer.innerHTML += relativeCard;
        });
    } catch (error) {
        console.error('Error fetching data:', error.message);
    }
}

// Fetch patient and relatives data on page load
document.addEventListener('DOMContentLoaded', () => {
    try {
        const userId = localStorage.getItem('userID'); // Get the user ID from local storage
        if (userId) {
            fetchPatientAndRelatives(userId);
        } else {
            console.error('No user ID found in local storage.');
        }
    } catch (error) {
        console.error('Error loading page:', error.message);
    }
});


</script>
</body>
</html>
